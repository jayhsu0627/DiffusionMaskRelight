INFO:__main__:***** Running training *****
INFO:__main__:  Num examples = 217
INFO:__main__:  Num Epochs = 100
INFO:__main__:  Instantaneous batch size per device = 1
INFO:__main__:  Total train batch size (w. parallel, distributed & accumulation) = 16
INFO:__main__:  Gradient Accumulation steps = 16
INFO:__main__:  Total optimization steps = 1400
Steps:   7%|███████████▌                                                                                                                                                     | 100/1400 [24:25<5:22:46, 14.90s/it, lr=2.94e-5, step_loss=0.864]INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-100
VAE precision: torch.float16
UNet precision: torch.float32
Optimizer dtype: torch.float32
pixel_values dtype: torch.float32
Configuration saved in /sdb5/output_3/checkpoint-100/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-100/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-100/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-100/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-100/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-100/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-100/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-100
Steps:  14%|███████████████████████                                                                                                                                          | 200/1400 [48:47<4:56:07, 14.81s/it, lr=2.96e-5, step_loss=0.203]INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-200
Configuration saved in /sdb5/output_3/checkpoint-200/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-200/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-200/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-200/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-200/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-200/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-200/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-200
Steps:  21%|██████████████████████████████████                                                                                                                             | 300/1400 [1:13:08<4:26:55, 14.56s/it, lr=2.83e-5, step_loss=0.207]INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-300
Configuration saved in /sdb5/output_3/checkpoint-300/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-300/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-300/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-300/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-300/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-300/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-300/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-300
Steps:  29%|█████████████████████████████████████████████▏                                                                                                                | 400/1400 [1:37:30<4:01:51, 14.51s/it, lr=2.63e-5, step_loss=0.0672]INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-400
Configuration saved in /sdb5/output_3/checkpoint-400/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-400/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-400/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-400/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-400/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-400/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-400/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-400
Steps:  36%|████████████████████████████████████████████████████████▊                                                                                                      | 500/1400 [2:01:56<3:35:52, 14.39s/it, lr=2.36e-5, step_loss=0.384]INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-500
Configuration saved in /sdb5/output_3/checkpoint-500/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-500/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-500/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-500/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-500/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-500/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-500/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-500
Steps:  43%|████████████████████████████████████████████████████████████████████▏                                                                                          | 600/1400 [2:30:41<4:23:52, 19.79s/it, lr=2.04e-5, step_loss=0.072]INFO:__main__:5 checkpoints already exist, removing 1 checkpoints
INFO:__main__:removing checkpoints: checkpoint-100
INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-600
Configuration saved in /sdb5/output_3/checkpoint-600/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-600/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-600/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-600/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-600/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-600/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-600/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-600
Steps:  50%|████████████████████████████████████████████████████████████████████████████████                                                                                | 700/1400 [3:04:08<3:20:19, 17.17s/it, lr=1.69e-5, step_loss=0.14]INFO:__main__:5 checkpoints already exist, removing 1 checkpoints
INFO:__main__:removing checkpoints: checkpoint-200
INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-700
Configuration saved in /sdb5/output_3/checkpoint-700/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-700/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-700/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-700/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-700/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-700/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-700/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-700
Steps:  57%|██████████████████████████████████████████████████████████████████████████████████████████▎                                                                   | 800/1400 [3:36:46<3:14:53, 19.49s/it, lr=1.33e-5, step_loss=0.0489]INFO:__main__:5 checkpoints already exist, removing 1 checkpoints
INFO:__main__:removing checkpoints: checkpoint-300
INFO:accelerate.accelerator:Saving current state to /sdb5/output_3/checkpoint-800
Configuration saved in /sdb5/output_3/checkpoint-800/unet/config.json
Model weights saved in /sdb5/output_3/checkpoint-800/unet/diffusion_pytorch_model.safetensors
INFO:accelerate.checkpointing:Optimizer state saved in /sdb5/output_3/checkpoint-800/optimizer.bin
INFO:accelerate.checkpointing:Scheduler state saved in /sdb5/output_3/checkpoint-800/scheduler.bin
INFO:accelerate.checkpointing:Sampler state for dataloader 0 saved in /sdb5/output_3/checkpoint-800/sampler.bin
INFO:accelerate.checkpointing:Gradient scaler state saved in /sdb5/output_3/checkpoint-800/scaler.pt
INFO:accelerate.checkpointing:Random states saved in /sdb5/output_3/checkpoint-800/random_states_0.pkl
INFO:__main__:Saved state to /sdb5/output_3/checkpoint-800
Steps:  58%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                                 | 819/1400 [3:43:26<3:11:23, 19.77s/it, lr=1.25e-5, step_loss=0.0355]Traceback (most recent call last):
  File "/sdb5/DiffusionMaskRelight/train_svd_relight_syn.py", line 1497, in <module>
    accelerator.end_training()
  File "/sdb5/DiffusionMaskRelight/train_svd_relight_syn.py", line 1322, in main
    # check https://arxiv.org/abs/2206.00364(the EDM-framework) for more details.
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/accelerate/utils/operations.py", line 819, in forward
    return model_forward(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/accelerate/utils/operations.py", line 807, in __call__
    return convert_to_fp32(self.model_forward(*args, **kwargs))
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/amp/autocast_mode.py", line 44, in decorate_autocast
    return func(*args, **kwargs)
  File "/sdb5/DiffusionMaskRelight/models/unet_spatio_temporal_condition.py", line 427, in forward
    aug_emb = self.add_embedding(time_embeds)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/diffusers/models/embeddings.py", line 1309, in forward
    sample = self.linear_2(sample)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/conda/envs/DiffLight/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
KeyboardInterrupt
